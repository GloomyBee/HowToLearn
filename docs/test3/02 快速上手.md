# 1.Docker CLI 命令行介绍
## Docker Version

Windows (Intel芯片)
```
$ docker version
Client: Docker Engine - Community
Cloud integration: 1.0.12
Version:           20.10.5
API version:       1.41
Go version:        go1.13.15
Git commit:        55c4c88
Built:             Tue Mar  2 20:14:53 2021
OS/Arch:           windows/amd64
Context:           default
Experimental:      true

Server: Docker Engine - Community
Engine:
Version:          20.10.5
API version:      1.41 (minimum version 1.12)
Go version:       go1.13.15
Git commit:       363e9a8
Built:            Tue Mar  2 20:15:47 2021
OS/Arch:          linux/amd64
Experimental:     false
containerd:
Version:          1.4.4
GitCommit:        05f951a3781f4f2c1911b05e61c160e9c30eaa8e
runc:
Version:          1.0.0-rc93
GitCommit:        12644e614e25b05da6fd08a38ffa0cfe1903fdec
docker-init:
Version:          0.19.0
GitCommit:        de40ad0
```

# 2.Docker命令行的基本使用

docker + 管理的对象（比如容器，镜像） + 具体操作（比如创建，启动，停止，删除）

例如

- `docker image pull nginx` 拉取一个叫nginx的docker image镜像
- `docker container stop web` 停止一个叫web的docker container容器
# 3.Image vs Container 镜像 vs 容器
## 3.1image镜像

- Docker image是一个 `read-only` 文件
- 这个文件包含文件系统，源码，库文件，依赖，工具等一些运行application所需要的文件
- 可以理解成一个模板
- docker image具有分层的概念

## 3.2container容器

- “一个运行中的docker image”
- 实质是复制image并在image最上层加上一层 `read-write` 的层 （称之为 `container layer` ,容器层）
- 基于同一个image可以创建多个container

## 3.3docker image的获取

- 自己制作
- 从registry拉取（比如docker hub）

# 4.容器的基本操作
## 4.1基本命令
![[Pasted image 20241110211532.png]]
```
$ docker container ps
CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS          PORTS     NAMES
cd3a825fedeb   nginx     "/docker-entrypoint.…"   7 seconds ago    Up 6 seconds    80/tcp    mystifying_leakey
269494fe89fa   nginx     "/docker-entrypoint.…"   9 seconds ago    Up 8 seconds    80/tcp    funny_gauss
34b68af9deef   nginx     "/docker-entrypoint.…"   12 seconds ago   Up 10 seconds   80/tcp    interesting_mahavira
7513949674fc   nginx     "/docker-entrypoint.…"   13 seconds ago   Up 12 seconds   80/tcp    kind_nobel
```


## 4.2批处理
法1：
```
docker container stop cd3 269 34b 751
```
法2：
```
$ docker container stop $(docker container ps -aq)
```
法3：
```
$ docker container ps -a
```

## 4.3批量删除

和批量停止类似，可以使用 `docker container rm $(docker container ps -aq)`

Note

`docker system prune -a -f` 可以快速对系统进行清理，删除停止的容器，不用的image，等等

# 5.容器运行的各种模式

## 5.1attach 模式

范例指令: docker container run -p 80:80 nginx

- 透过这种方式创建容器的话，容器在前台执行
    
- 容器的输入输出结果会反映到本地端，本地端的输入输出也会反映到容器，例如能在终端机看到网页浏览器的 log，ctrl + c 会让容器停止执行
    
- 一般情况不推荐使用
    

## 5.2detach 模式

范例指令: docker container run -d -p 80:80 nginx

- 容器会在后台执行

# 6.连接容器的shell

## 6.1`docker container run -it` 创建一个容器并进入交互式模式
```
➜  ~ docker container run -it busybox sh
/ #
/ #
/ # ls
bin   dev   etc   home  proc  root  sys   tmp   usr   var
/ # ps
PID   USER     TIME  COMMAND
    1 root      0:00 sh
    8 root      0:00 ps
/ # exit
```


## 6.2`docker container exec -it` 在一个已经运行的容器里执行一个额外的command
```
➜  ~ docker container run -d nginx
33d2ee50cfc46b5ee0b290f6ad75d724551be50217f691e68d15722328f11ef6
➜  ~
➜  ~ docker container exec -it 33d sh
#
#
# ls
bin  boot  dev  docker-entrypoint.d  docker-entrypoint.sh  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var
#
# exit
➜  ~
```
